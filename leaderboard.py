import streamlit as st
import pandas as pd
import datetime

# ğŸš€ í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • (ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤)
st.set_page_config(
    page_title="HW 01 ë¦¬ë”ë³´ë“œ",
    page_icon="ğŸ†",
    layout="wide"  # í˜ì´ì§€ë¥¼ ë„“ê²Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
)

# --- ë°ì´í„° ê´€ë¦¬ ---

def get_leaderboard_data():
    """
    í•™ìƒ ID ë° ì ìˆ˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    (ë°ì´í„°ê°€ ê¸¸ì–´ì„œ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.)
    """
    # í•™ìƒ ID ë¦¬ìŠ¤íŠ¸ ğŸ§‘â€ğŸ“
    student_ids = [
        20231837, 20211402, 20211733, 20231851, 20231852, 20231846, 20231831, 20231843,
        20230320, 20231854, 20220378, 20211168, 20210261, 20200025, 20231218, 20241901,
        20221593, 20201227, 20241909, 20211166, 20241584, 20200307, 20232241, 20220154,
        20231834, 20231842, 20211352, 20211188, 20181599, 20201608, 20201625, 20191347,
        20221931, 20201396, 20221995, 20221201, 20201638, 20200595, 20201607, 20211014,
        20201663, 20221300, 20231838, 20191666, 20191579
    ]
    
    # Accuracy ì ìˆ˜ (ì˜ˆì‹œ ë°ì´í„°) ğŸ¯
    scores_accuracy_dict = {
        20231837: 0.9, 20211402: 0, 20211733: 0, 20231851: 0, 20231852: 0,
        20231846: 0, 20231831: 0, 20231843: 0, 20230320: 0, 20231854: 0,
        20220378: 0, 20211168: 0, 20210261: 0, 20200025: 0, 20231218: 0,
        20241901: 0, 20221593: 0, 20201227: 0, 20241909: 0, 20211166: 0,
        20241584: 0, 20200307: 0, 20232241: 0, 20220154: 0, 20231834: 0,
        20231842: 0, 20211352: 0, 20211188: 0, 20181599: 0, 20201608: 0,
        20201625: 0, 20191347: 0, 20221931: 0, 20201396: 0, 20221995: 0,
        20221201: 0, 20201638: 0, 20200595: 0, 20201607: 0, 20211014: 0,
        20201663: 0, 20221300: 0, 20231838: 0, 20191666: 0, 20191579: 0
    }
    
    # RMSE ì ìˆ˜ (ì˜ˆì‹œ ë°ì´í„°) ğŸ“‰
    scores_rmse_dict = {
        20231837: 130, 20211402: 999, 20211733: 999, 20231851: 999, 20231852: 999,
        20231846: 999, 20231831: 999, 20231843: 999, 20230320: 999, 20231854: 999,
        20220378: 999, 20211168: 999, 20210261: 999, 20200025: 999, 20231218: 999,
        20241901: 999, 20221593: 999, 20201227: 999, 20241909: 999, 20211166: 999,
        20241584: 999, 20200307: 999, 20232241: 999, 20220154: 999, 20231834: 999,
        20231842: 999, 20211352: 999, 20211188: 999, 20181599: 999, 20201608: 999,
        20201625: 999, 20191347: 999, 20221931: 999, 20201396: 999, 20221995: 999,
        20221201: 999, 20201638: 999, 20200595: 999, 20201607: 999, 20211014: 999,
        20201663: 999, 20221300: 999, 20231838: 999, 20191666: 999, 20191579: 999
    }    

    
    return student_ids, scores_accuracy_dict, scores_rmse_dict

# --- DataFrame ìƒì„± í•¨ìˆ˜ ---

def create_leaderboard_df(student_ids, scores_dict, metric_name, ascending=False):
    """ë¦¬ë”ë³´ë“œ ìˆœìœ„ê°€ ë§¤ê²¨ì§„ DataFrameì„ ìƒì„±í•©ë‹ˆë‹¤."""
    
    df = pd.DataFrame({'Student_ID': student_ids})
    df[metric_name] = df['Student_ID'].map(scores_dict)
    
    # ì ìˆ˜ê°€ ì—†ëŠ” í•™ìƒì€ ë¦¬ë”ë³´ë“œì—ì„œ ì œì™¸
    df = df.dropna(subset=[metric_name])
    
    # ì ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
    df = df.sort_values(by=metric_name, ascending=ascending).reset_index(drop=True)
    
    # ìˆœìœ„(Rank)ë¥¼ 1ë¶€í„° ì‹œì‘í•˜ë„ë¡ ì„¤ì •
    df.index += 1
    df.index.name = 'Rank'
    
    # Student_IDë¥¼ ë¬¸ìì—´ë¡œ ë³€ê²½ (í‘œì‹œìš©)
    df['Student_ID'] = df['Student_ID'].astype(str)
    
    # RMSEëŠ” ì†Œìˆ˜ì  3ìë¦¬ê¹Œì§€ë§Œ í‘œì‹œ
    if metric_name == 'RMSE':
        df[metric_name] = df[metric_name].round(3)
        
    return df

# --- Streamlit ì•± ë©”ì¸ ë¡œì§ ---

def main():
    # --- 1. íƒ€ì´í‹€ ë° ì„¤ëª… ---
    st.title("ğŸ† HW 02 Leaderboard")
    st.markdown("ë³¸ ë¦¬ë”ë³´ë“œëŠ” CNN ëª¨ë¸ì˜ **My Method ì„±ëŠ¥**ì„ í‰ê°€í•˜ì—¬ ìˆœìœ„ë¥¼ ë§¤ê¸´ ê²ƒì…ë‹ˆë‹¤.")

    # --- 2. ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ ---
    now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    st.info(f"ğŸ—“ï¸ ë¦¬ë”ë³´ë“œëŠ” ë§¤ì¼ ì˜¤ì „ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤. (ì—…ë°ì´íŠ¸ ì‹œê°„: {now})")

    # --- 3. ë°ì´í„° ë¡œë“œ ---
    student_ids, scores_acc, scores_rmse = get_leaderboard_data()

    # --- 4. Accuracy ë¦¬ë”ë³´ë“œ ---
    st.divider()  # ì‹œê°ì  êµ¬ë¶„ì„ 
    st.subheader("ğŸ¯ Accuracy (ë‹¹ë‡¨ë³‘ ì˜ˆì¸¡ ì„±ëŠ¥)")
    st.markdown("`Accuracy`ëŠ” **ë†’ì„ìˆ˜ë¡** ì¢‹ìŠµë‹ˆë‹¤. (1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ìš°ìˆ˜)")
    
    df_acc = create_leaderboard_df(
        student_ids=student_ids,
        scores_dict=scores_acc,
        metric_name='Accuracy',
        ascending=False  # ë†’ì€ ì ìˆ˜ê°€ ìœ„ë¡œ
    )
    # width='stretch'ë¡œ ì„¤ì •í•˜ì—¬ í‘œë¥¼ í˜ì´ì§€ ë„ˆë¹„ì— ë§ì¶¥ë‹ˆë‹¤. (ì´ì „ use_container_width=True ëŒ€ì²´)
    st.dataframe(df_acc, width='stretch')

    # --- 5. RMSE ë¦¬ë”ë³´ë“œ (ìì‚´ ì˜ˆì¸¡) ---
    st.divider()  # ì‹œê°ì  êµ¬ë¶„ì„ 
    st.subheader("ğŸ“‰ RMSE (ìì‚´ ì˜ˆì¸¡ ì„±ëŠ¥)")
    st.markdown("`RMSE`ëŠ” **ë‚®ì„ìˆ˜ë¡** ì¢‹ìŠµë‹ˆë‹¤. (0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ìš°ìˆ˜)")
    
    df_rmse = create_leaderboard_df(
        student_ids=student_ids,
        scores_dict=scores_rmse,
        metric_name='RMSE',
        ascending=True  # ë‚®ì€ ì ìˆ˜ê°€ ìœ„ë¡œ
    )
    # width='stretch'ë¡œ ì„¤ì •í•˜ì—¬ í‘œë¥¼ í˜ì´ì§€ ë„ˆë¹„ì— ë§ì¶¥ë‹ˆë‹¤. (ì´ì „ use_container_width=True ëŒ€ì²´)
    st.dataframe(df_rmse, width='stretch')

# --- ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ---
if __name__ == "__main__":

    main()
